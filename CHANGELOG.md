# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).

---

## [Unreleased]

---

## [2026-02-18] — Workflow Approval Gate

### Added

- **Workflow approval gates** — Workflow steps can now require human approval before execution proceeds. Declare `approval_required: true` on any step in your YAML workflow definition to pause the workflow and await an explicit approve or deny action.

- **YAML approval fields** — Three new fields are supported on workflow steps:
  - `approval_required` (bool) — gates execution on human approval
  - `approval_timeout` (int, seconds) — optional deadline after which the gate expires (e.g. `86400` for 24 hours)
  - `approvers` (list of strings) — optional list of named approvers (e.g. `["tech-lead", "devops-team"]`)

  Example:
  ```yaml
  steps:
    - name: design
      agent: Architect
      approval_required: true
      approval_timeout: 86400

    - name: deploy
      agent: OpsCommander
      approval_required: true
      approvers: ["tech-lead", "devops-team"]
  ```

- **`AWAITING_APPROVAL` workflow state** — New enum value in `WorkflowState`; a workflow in this state is safely paused and survives service restarts.

- **`WorkflowEngine.approve_step()` / `deny_step()`** — New engine methods to resume or fail a workflow at its approval gate programmatically.

- **Persistent approval state** — `StateManager` gains `set_pending_approval()`, `get_pending_approval()`, and `clear_pending_approval()` backed by the existing JSON persistence layer, so approval state survives process restarts.

- **Telegram approval notifications** — When a step is gated, `notify_approval_required()` sends an inline-keyboard message to configured Telegram chats with **Approve** and **Deny** buttons. Button presses are handled by new `wfapprove_` / `wfdeny_` callback handlers in `telegram_bot.py`.

- **21 new tests** in `tests/test_workflow_approval.py` covering approval gate happy-path, denial, timeout semantics, and persistence. All 136 tests pass with no regressions.

### Changed

- `WorkflowDefinition.from_dict()` / `from_yaml()` now parses the three new approval fields from step definitions (`nexus_core_helpers.py`, `models.py`).
- `WorkflowEngine.complete_step()` checks whether the next step requires approval and transitions to `AWAITING_APPROVAL` when applicable (`src/inbox_processor.py`).

### Fixed

- None.

---

_Generated by @Scribe — nexus-core issue [#1](https://github.com/Ghabs95/nexus-core/issues/1)_
